<%= javascript_include_tag Ckeditor.cdn_url %>

<div class="row">
  <div class="col-md-6">
    <div class="panel panel-primary">
      <div class="panel-heading">Ученик</div>
      <div class="panel-body">
        <div class="row">
          <div class="col-xs-4">
            <label><%= Student.human_attribute_name :first_name %></label>
          </div>
          <div class="col-xs-8">
            <%= @student.first_name %>
          </div>
        </div>
        <div class="row">
          <div class="col-xs-4">
            <label><%= Student.human_attribute_name :middle_name %></label>
          </div>
          <div class="col-xs-8">
            <%= @student.middle_name %>
          </div>
        </div>

        <div class="row">
          <div class="col-xs-4">
            <label>Фамилия</label>
          </div>
          <div class="col-xs-8">
            <%= @student.last_name %>
          </div>
        </div>
        <div class="row">
          <div class="col-xs-4">
            <label><%= Student.human_attribute_name :region %></label>
          </div>
          <div class="col-xs-8">
            <%= @student.region.name %>
          </div>
        </div>
        <div class="row">
          <div class="col-xs-4">
            <label><%= Student.human_attribute_name :city %></label>
          </div>
          <div class="col-xs-8">
            <%= @student.city.name %>
          </div>
        </div>
        <div class="row">
          <div class="col-xs-4">
            <label><%= Student.human_attribute_name :school %></label>
          </div>
          <div class="col-xs-8">
            <p><%= @student.school.name %></p>
            <p><%= School.human_attribute_name :admin_id %>: <%= @student.school.admin_id %></p>
          </div>
        </div>
        <div class="row">
          <div class="col-xs-4">
            <label><%= Student.human_attribute_name :exams %></label>
          </div>
          <div class="col-xs-8">
            <%= @student.exams.map(&:name).join(', ') %>
          </div>
        </div>
        <!--        <div class="row">-->
        <!--          <div class="col-xs-4">-->
        <!--            <label><%#= Student.human_attribute_name :declaration %></label>-->
        <!--          </div>-->
        <!--          <div class="col-xs-8">-->
        <%# if @request.student.declaration.attached? %>
        <%#= link_to 'Изтегли', @request.student.declaration %>
        <%#= image_tag @request.student.declaration, :class => 'img-responsive' %>
        <%# else %>
        <!--              Не е прикачена декларация.-->
        <%# end %>

        <!--          </div>-->

        <!--        </div>-->

      </div>
    </div>
    <div class="panel panel-primary">
      <div class="panel-heading"><%= User.model_name.human %></div>
      <div class="panel-body">
        <div class="row">
          <div class="col-xs-4">
            <label><%= User.human_attribute_name :first_name %></label>
          </div>
          <div class="col-xs-8">
            <%= @student.user.first_name %>
          </div>
        </div>
        <div class="row">
          <div class="col-xs-4">
            <label><%= User.human_attribute_name :last_name %></label>
          </div>
          <div class="col-xs-8">
            <%= @student.user.last_name %>
          </div>
        </div>
        <div class="row">
          <div class="col-xs-4">
            <label><%= User.human_attribute_name :phone %></label>
          </div>
          <div class="col-xs-8">
            <%= tel_to @student.user.phone %>
          </div>
        </div>
        <div class="row">
          <div class="col-xs-4">
            <label><%= User.human_attribute_name :email %></label>
          </div>
          <div class="col-xs-8">
            <%= mail_to @student.user.email %>
          </div>
        </div>
      </div>
    </div>

  </div>
  <div class="col-md-6">
    <% unless @student.is_approved? or @student.is_declined? %>

      <div class="panel panel-default">
        <div class="panel-heading">Операции</div>
        <div class="panel-body">
          <div class="row">
            <div class="col-xs-6">
              <%= link_to "Одобри", approve_approval_path(@student.id), :class => "btn btn-success btn-block" %>
            </div>

            <div class="col-xs-6">
              <%= link_to "Отхвърли", reject_approval_path(@student.id), :class => "btn btn-danger btn-block" %>
            </div>
          </div>
        </div>
      </div>
    <% end %>
    <div class="panel panel-default">
      <div class="panel-heading">История</div>
      <div class="panel-body">
        <div class="row">
          <div class="col-xs-4">
            <label><%= Student.human_attribute_name :created_at %></label>
          </div>
          <div class="col-xs-8">
            <%= l @student.created_at, :format => :long %>
          </div>
        </div>
        <div class="row">
          <div class="col-xs-4">
            <label><%= Student.human_attribute_name :updated_at %></label>
          </div>
          <div class="col-xs-8">
            <%= l @student.updated_at, :format => :long %>
          </div>
        </div>
        <% if @student.is_approved? %>
          <div class="row">
            <div class="col-xs-4">
              <label><%= Student.human_attribute_name :approved_at %></label>
            </div>
            <div class="col-xs-8">
              <%= l @student.approved_at, :format => :long %>
            </div>
          </div>
          <div class="row">
            <div class="col-xs-4">
              <label>Одобрена от</label>
            </div>
            <div class="col-xs-8">
              <%= @student.approver.full_name %> <<%= mail_to @student.approver.email %>
              , <%= tel_to @student.approver.phone %>>
            </div>
          </div>
        <% end %>
        <% if @student.is_declined? %>
          <div class="row">
            <div class="col-xs-4">
              <label><%= Student.human_attribute_name :declined_at %></label>
            </div>
            <div class="col-xs-8">
              <%= l @student.declined_at, :format => :long %>
            </div>
          </div>
          <div class="row">
            <div class="col-xs-4">
              <label>Отхвърлена от</label>
            </div>
            <div class="col-xs-8">
              <%= @student.approver.full_name %> <<%= mail_to @student.approver.email %>
              , <%= tel_to @student.approver.phone %>>
            </div>
          </div>
        <% end %>
      </div>
    </div>
    <div class="panel panel-default">
      <div class="panel-heading"><%= Student.human_attribute_name :comments %></div>
      <div class="panel-body">
        <div class="row">
          <div class="col-xs-12">
            <button href="#" class="btn btn-primary btn-block" data-toggle="modal" data-target="#comment-modal">Добави
              коментар
            </button>
          </div>
        </div>
        <br/>
        <% unless @student.comments.blank? %>
          <% @student.comments.order(:created_at => :desc).each do |c| %>
            <div class="row">
              <div class="col-xs-12">
                <p><%= c.user.full_name %> (на <%= l c.created_at, :format => :long %>)<br/>
                  Email: <%= mail_to c.user.email %>, Телефон: <%= tel_to c.user.phone %><br/>
                </p>
                <%= simple_format c.content %>
              </div>
            </div>
            <hr/>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>
</div>

<div class="modal" tabindex="-1" role="dialog" id="comment-modal" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Коментар
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span></button>
        </h5>

      </div>
      <div class="modal-body">
        <%= bootstrap_form_for Comment.new, url: comments_path, include_id: false, method: :post do |f| %>
          <%= f.hidden_field :student_id, :value => @student.id %>
          <%= f.cktext_area :content, :class => :ckeditor, ckeditor: {language: 'bg'} %>
          <%= f.submit 'Създай', class: 'btn btn-primary btn-block' %>
        <% end %>
      </div>
    </div>
  </div>
</div>
